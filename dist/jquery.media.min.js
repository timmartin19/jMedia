/**
 * Created by martin on 1/26/15.
 */
function Player(e){e=e[1];this.types=[];this.ieAttrs=[];this.name=null;this.isMSIE=/MSIE/.test(navigator.userAgent);this.isOldIE=this.isMSIE&&(/MSIE (6|7|8)\.0/.test(navigator.userAgent)||mode<9);var t=Media.defaults.extensions[e];for(var n in t){if(t.hasOwnProperty(n)){this[n]=t[n]}}}var Media;Media={convertToMedia:function(e,t,n,r){var i,s;return e.each(function(){var e=$(this);t=t||{};i=Media.private.getSettings(this,t);if(n){n(this,i)}if(!i.type){i.type=Media.private.getExtensionType(i.src.toLowerCase())}s=Media.private.generateHTMLPlayerElement(this,i,i.type);e.replaceWith(s);if(r){r(this,s,i,i.type)}})},undo:function(e){return e.each(function(){var e=this;var t=e.data("media.origHTML");if(t){e.replaceWith(t)}else{console.info("No original HTML was found on a media object.")}})}};$.fn.media=function(e,t,n){if(e==="undo"){Media.undo(this)}else{Media.convertToMedia(this,e,t,n)}};Media.defaults={standards:true,canUndo:true,width:400,height:400,autoplay:0,bgColor:"#FFFFFF",params:{wmode:"transparent"},attrs:{},flvKeyName:"file",flashvars:{},flashVersion:"7",expressInstaller:null,flvPlayer:"mediaplayer.swf",mp3Player:"mediaplayer.swf",silverlight:{inplaceInstallPrompt:"true",isWindowless:"true",framerate:"24",version:"0.9",onError:null,onLoad:null,initParams:null,userContext:null}};Media.defaults.players={flash:{name:"flash",title:"Flash",mimetype:"application/x-shockwave-flash",pluginspage:"http://www.adobe.com/go/getflashplayer",ieAttrs:{classid:"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",type:"application/x-oleobject",codebase:"http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version="+Media.defaults.flashVersion}},quicktime:{name:"quicktime",title:"QuickTime",mimetype:"video/quicktime",pluginspage:"http://www.apple.com/quicktime/download/",ieAttrs:{classid:"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",codebase:"http://www.apple.com/qtactivex/qtplugin.cab"}},realplayer:{name:"real",title:"RealPlayer",mimetype:"audio/x-pn-realaudio-plugin",pluginspage:"http://www.real.com/player/",autoplayAttr:"autostart",ieAttrs:{classid:"clsid:CFCDAA03-8BE4-11cf-B84B-0020AFBBCCFA"}},winmedia:{name:"winmedia",title:"Windows Media",mimetype:"application/x-mplayer2",pluginspage:"http://www.microsoft.com/Windows/MediaPlayer/",autoplayAttr:"autostart",oUrl:"url",ieAttrs:{classid:"clsid:6BF52A52-394A-11d3-B153-00C04F79FAA6",type:"application/x-oleobject"}},img:{name:"img",title:"Image"},iframe:{name:"iframe"},silverlight:{name:"silverlight"}};Media.defaults.extensions={flv:Media.defaults.players.flash,mp3:Media.defaults.players.flash,swf:Media.defaults.players.flash,aif:Media.defaults.players.quicktime,aiff:Media.defaults.players.quicktime,aac:Media.defaults.players.quicktime,au:Media.defaults.players.quicktime,bmp:Media.defaults.players.quicktime,gsm:Media.defaults.players.quicktime,mov:Media.defaults.players.quicktime,mid:Media.defaults.players.quicktime,midi:Media.defaults.players.quicktime,mpg:Media.defaults.players.quicktime,mpeg:Media.defaults.players.quicktime,mp4:Media.defaults.players.quicktime,m4a:Media.defaults.players.quicktime,psd:Media.defaults.players.quicktime,qt:Media.defaults.players.quicktime,qtif:Media.defaults.players.quicktime,qif:Media.defaults.players.quicktime,qti:Media.defaults.players.quicktime,snd:Media.defaults.players.quicktime,tif:Media.defaults.players.quicktime,tiff:Media.defaults.players.quicktime,wav:Media.defaults.players.quicktime,"3g2":Media.defaults.players.quicktime,"3gp":Media.defaults.players.quicktime,ra:Media.defaults.players.realplayer,ram:Media.defaults.players.realplayer,rm:Media.defaults.players.realplayer,rpm:Media.defaults.players.realplayer,rv:Media.defaults.players.realplayer,smi:Media.defaults.players.realplayer,smil:Media.defaults.players.realplayer,html:Media.defaults.players.iframe,pdf:Media.defaults.players.iframe,gif:Media.defaults.players.img,png:Media.defaults.players.img,jpg:Media.defaults.players.img,silverlight:Media.defaults.players.silverlight,asx:Media.defaults.players.winmedia,asf:Media.defaults.players.winmedia,avi:Media.defaults.players.winmedia,wma:Media.defaults.players.winmedia,wmv:Media.defaults.players.winmedia};Player.prototype.generate=function(e,t){var n=this.generateHTML(t);var r=$("<div></div>");r.append(n);if(e.id){r.attr("id",e.id)}if(e.class){r.attr("class",e.class)}if(t.caption){$("<div>").appendTo(r).html(t.caption)}return r};Player.prototype.generateHTML=function(e){var t;if(this.name==="iframe"){t=$("<iframe"+' width="'+e.width+'" height="'+e.height+'" >');t.attr("src",e.src)}else if(this.isOldIE){t=$("<object></object>");t=this.setAttributesOnElement(t,e.attrs);if(this.ieAttrs){this.setAttributesOnElement(t,this.ieAttrs)}t=this.setParameterTags(t,e)}else if(e.standards){t=$("<object></object>");t.attr("type",this.mimetype);t=this.setHeightAndWidthTag(t,e);if(e.src){t.attr("data",e.src)}if(this.isMSIE){t=this.setAttributesOnElement(t,this.ieAttrs)}t=this.setParameterTags(t,e);t.append($("<div><p><strong>"+this.title+" Required</strong></p><p>"+this.title+' is required to view this media. <a href="'+this.pluginspage+'">Download Here</a>.</p></div>'))}else{t=$("<embed></embed>");t=this.setHeightAndWidthTag(t,e);if(e.src){t.attr("src",e.src)}t=this.setAttributesOnElement(t,e.attrs);t=this.setAttributesOnElement(t,this.eAttrs);t=this.setAttributesOnElement(t,e.params)}return t};Player.prototype.setHeightAndWidthTag=function(e,t){return e.attr("width",t.width).attr("height",t.height)};Player.prototype.setAttributesOnElement=function(e,t){for(var n in t){if(t.hasOwnProperty(n)){e.attr(n,t[n])}}return e};Player.prototype.setParameterTags=function(e,t){var n=[];var r=$("<parameter/>");r.attr("name",this.oUrl||"src").attr("value",t.src);n.push(r);for(key in t.params){if(t.params.hasOwnProperty(key)){r=$("<parameter/>");r.attr("name",key).attr("value",t.params[key]);n.push(r)}}for(var i=0;i<n.length;i++){e.append(n[i])}return e};Media.private={generateHTMLPlayerElement:function(e,t,n){var r=new Player(n);return r.generate(e,t)},getPlayerForType:function(e){for(var t in Media.defaults.players){if(Media.defaults.players.hasOwnProperty(t)){if($.inArray(e,Media.defaults.players[t].types)){return Media.defaults.players[t]}}}throw"A player for extension type "+e+" was not found"},getSettings:function(e,t){var n,r,i,s;s=$(e);t=t||{};r=Media.private.getMetaSettings(e);n=Media.defaults;i=$.extend(n,r,t);if(typeof (i.caption===undefined)){i.caption=s.text()}if(i.src===undefined){i.src=s.attr("href")||s.attr("src")}if(i.src===undefined){throw"No source was defined on the element. Either href or src needs to be set on the element."}if(!i.params){i.params={}}return i},getMetaSettings:function(e){var t,n,r;var i="data-";var s=$(e);if($.metadata){t=s.metadata()}else if($.meta){t=s.data()}if(!t){t={}}t.elementClass=e.className||"";if(!t.width){t.width=parseInt((t.elementClass.match(/\bw:(\d+)/)||[])[1]||0,10)||parseInt((t.elementClass.match(/\bwidth:(\d+)/)||[])[1]||0,10)}if(!t.height){t.height=parseInt((t.elementClass.match(/\bh:(\d+)/)||[])[1]||0,10)||parseInt((t.elementClass.match(/\bheight:(\d+)/)||[])[1]||0,10)}for(var o=0;o<e.attributes.length;o++){n=e.attributes[o];r=$.trim(n);if(r.slice(0,i.length)==i){t[r]=n.value}}return t},getExtensionType:function(e){var t,n;for(var r in Media.defaults.extensions){if(Media.defaults.extensions.hasOwnProperty(r)){t=new RegExp("\\.("+r+")\\b");n=t.exec(e);if(n){return n}}}throw"No usable extension was found on the url: "+e}}